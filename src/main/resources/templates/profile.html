<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Details</title>
    <!-- ------------------Custom Css link -->
    <link rel="stylesheet" href="./Assets/Pstyle.css">
    <!-- ----Font Awesome  -->
    <link rel="stylesheet" href="./fontawesome-free-6.3.0-web/css/all.css">    <!-- -------Swiper Slider Link------ -->
    <link rel="stylesheet" href="./Assets/postStyle.css">
    <link rel="stylesheet" href="./Assets/Swiper/swiper-bundle.min.css">
    <style>

        .modalshare {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0,0,0);
            background-color: rgba(0,0,0,0.4);
            animation: fadeIn 0.5s;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            position: absolute;
            bottom: 0;
            transform: translateY(0%);
            animation: slideUpToHalf 0.5s forwards;
        }

        .closeshare {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .closeshare:hover,
        .closeshare:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        textarea {
            width: 100%;
            height: 100px;
            margin-bottom: 10px;
        }

        select {
            width: 100%;
            height: 30px;
            margin-bottom: 10px;
        }

        button {
            width: 100%;
            height: 40px;
        }

        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }

        @keyframes slideUpToHalf {
            from {transform: translateY(100%);}
            to {transform: translateY(-50%);}
        }

        .text-container {
            width: 100%; /* Set the width of the container */
            overflow: hidden; /* Hide overflow text */
            position: relative;
            margin-bottom: 20px;
        }

        .text {
            margin: 0; /* Remove default margin */
        }

        .see-more {
            color: blue;
            cursor: pointer;
            display: none; /* Hide initially */
            position: absolute;
            right: 0;
            bottom: 0;
            background: white;
        }

        .hidden {
            display: none;
        }
        .add-friend{
            display: flex;
        }


        /*aung myint tun*/
        .btn-confirm{

            padding: 7px 22px;
            text-decoration: none;
            text-align: center;
            background-color: #1714b4;
            color: white;
             margin-right:15px;
            border-radius: 7px;
        }
        /*aung myint tun*/
    </style>
</head>

<body style="background-color: #c7ced5">


    <!-- ..................Start Navbar...................... -->
    <nav>
        <div class="container nav-container">
            <div class="logo">
                <img src="/assests/Untitled-1.png" style="width: 100%; height: 50px;">
            </div>
            <div class="serch-bar">
                <i class="fa fa-search"></i>
                <input type="search" name="" id="search" placeholder="Search For Creators">
            </div>
            <div class="add-post">
<!--                <label for="add-post" class="btn btn-primary">Add Post</label>-->
                <div class="" style="width:200px; display: flex;right: 20px;position: absolute;">

                    <a onclick="let userConfirmed = confirm('Are you sure you want to log out?'); if (userConfirmed) { window.location.href = 'logout'; }"><img title="Logout" src="/assests/OOjs_UI_icon_logOut-ltr-progressive.svg.png" alt="Logout" style="cursor:pointer;width: 30px;height:30px;"></a>
                </div>
            </div>
        </div>
    </nav>
    <!-- ...................Start Navbar................... -->


    <!-- ...................Start Main Session...................-->
    <main>
        <div class="main-container">


            <!-- ...........Main Left Start......... -->
            <div class="main-left" >
                <div class="profile" id="pfAdjust" style="display: none">

                    <img src="." alt="Profile Picture"
                         style="border: 2px dashed purple" id="my-profile-picture1" class="profile-picture">


                    <!-- Container to display added bio -->
                    <div id="userBio" onclick="editBio()">Add bio</div>

                    <div class="profile-info" id="my-profile-picture">
                        <h2 id="nm">loading</h2>
                        <p id="em">loading</p>
                    </div>

                    <!--        aung myint tun-->
                    <div class="add-friend">


                    <div class="" id="friBtn">

                    </div>
                    <div class="" id="delBtn">

                    </div>
                    </div>
                    <!--        aung myint tun-->

                    <div class="details">
                        <div ><i class="fas fa-university"></i>Major : <p id="mj"></p></div>
                        <div ><i class="fas fa-id-badge"></i> Roll Number:<p id="rno"></p></div>
                        <div><i class="fas fa-birthday-cake"></i> Date of Birth: <p id="dob"></p></div>

                        <div><i class="fas fa-venus-mars"></i> Gender:<p id="gender"></p> </div>
                        <div><i class="fas fa-phone"></i> Phone: <p id="ph"></p></div>
                        <div><i class="fas fa-map-marker-alt"></i>Lives in <p id="addrs"></p></div>

                    </div>

                </div>

                <!-- ..........Add Post Btn...........-->
                    <label for="add-post" class="hidden btn btn-primary btn-lg" onclick="labelFun()" id="my-profile-label">Edit Profile
                    Details</label>

            </div>
            <!-- ...........Main Left End......... -->

            <!--======================Main Middle Start====================== -->

            <div class="main-middle ">
               <div class="middle-container" >
                   <div style="text-align: center;left:10%;top:15%;position: absolute;">
                       <img id="loadingImage" src="/assests/Vanilla@1x-0.4s-246px-50px%20(1).svg" alt="Centered Image" style="display: block; margin-left: auto; margin-right: auto;">
                   </div>
<div  id="postsContainer" class="feeds">

</div>

               </div>
                    <!-- -------------------Feed Aria End----------- ----->
                </div>
            </div>
            <!-- ======================Main Middle End======================-->


    </main>
    <!-- ...................End Main Session................... -->

    <!-- -----------------------Start PopUps Aria----------------- -->
    <!-- ----------Start Profile-Popup------------- -->
    <div class="popup profile-popup">
        <div>
            <div class="popup-box profile-popup-box">
                <h1>Edit Profile</h1>

                <form id="edit-profile-form">

                    <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" id="name" name="name" required>
                    </div>

<!--                    <div class="form-group">-->
<!--                        <label for="email">Email</label>-->
<!--                        <input type="email" id="email" name="email" required>-->
<!--                    </div>-->


                    <div class="form-group">
                        <label for="phone">Phone</label>
                        <input type="tel" id="phone" name="phone">
                    </div>

                    <div class="form-group">
                        <label for="major">Major</label>
                        <input type="text" id="major" name="major">
                    </div>

                    <div class="form-group">
                        <label for="roll-number">Roll Number</label>
                        <input type="text" id="roll-number" name="roll-number">
                    </div>

                    <div class="form-group">
                        <label for="date-of-birth">Date of Birth</label>
                        <input type="date" id="date-of-birth" name="date-of-birth">
                    </div>

                    <div class="form-group">
                        <label for="address">Address</label>
                        <textarea id="address" name="address" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Gender</label>
                        <div class="radio-group">
                            <label for="male">
                                <input type="radio" id="male" name="gender" value="Male">
                                <span>Male</span>
                            </label>
                            <label for="female">
                                <input type="radio" id="female" name="gender" value="Female">
                                <span>Female</span>
                            </label>

                        </div>


                    </div>


                </form>
                <div>
                    <button  id="editProfile" class="btn btn-primary">Save Changes</button>
                </div>
            </div>
            <span class="close"><i class="fa fa-close"></i></span>
        </div>
    </div>

    <!-- ----------Start Profile-Popup------------- -->
    <div class="popup profile-popup1">
        <div>
            <div class="popup-box profile-popup-box" style=" width: 400px;
    height: 460px;
    background: var(--color-white);
    padding: var(--card-padding);
    color: var(--color-black);
    border-radius: var(--card-border-radius);
    justify-content: center;
    align-items: center;
    text-align: center;
    display: flex;
    flex-direction: column;">
                <h1 id="nameForModal">loading</h1>
                <p id="name2ForModal">loading</p>
                <div id="my-profile-picture123">
                    <img id="imageForModal" src="./Assets/images/img/profile-1.jpeg">
                </div>
                <label for="profile-upload" class="btn btn-primary btn-lg">Update Your Profile Picture</label>
                <input type="file" name="" accept="image/*" id="profile-upload">
                <button onclick="uploadImage()" id="save" class="btn btn-primary btn-lg">Save</button>
            </div>
            <span class="close"><i class="fa fa-close"></i></span>
        </div>
    </div>
    <!-- ----------End Profile-Popup------------- -->

    <!-- -----------------------End PopUps Aria----------------- -->


    <!-- ----------------Swiper JS---------------------- -->
    <script src="./assests/js/LikeComShr.js"></script>
    <script>
        var swiper = new Swiper(".mySwiper", {
            slidesPerView: 8,
            spaceBetween: 10,
            pagination: {
                el: ".swiper-pagination",
                clickable: true,
            },
            navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
            },
            direction: 'horizontal', // Ensures horizontal sliding
        });


        // Function to edit bio

    </script>

    <script src="./Assets/Swiper/swiper-bundle.min.js"></script>
    <!-- Custom Js Link -->





    <script src="assests/js/jquery.min.js"></script>
    <script>
        var id=sessionStorage.getItem("id");
        var username = '[[${email}]]';
        var otheremail = '[[${otheremail}]]';
        var otherid='[[${otherid}]]';
        console.log(username);
        if(otheremail!==''){
            $('#userBio').attr('onclick','');
            $('.profile-info').css('pointer-events', 'none');

            // aung myint tun

            $.get('/friend/getFriendBtn', { id: id, otherEmail:otheremail }, function(response) {

                console.log("Btn type = "+response);
                console.log(response.status);

                var buttonAction;

                if(response.status==="Cancel Request")
                    buttonAction="cancelFunc";
                if(response.status==="Add Friend")
                    buttonAction="addFunc";
                if(response.status==="Confirm")
                    buttonAction="confirmFunc";
                if(response.status==="Friend")
                    buttonAction="cancelFunc";


                let friBtn=$('#friBtn');
                let delBtn=$('#delBtn');
                friBtn.empty();
                // Create the new button and set its HTML
                if(response.status==="Confirm")
                {
                    let buttonHTML = `<a class="btn-confirm" id="btn" onclick="${buttonAction}(otherid)">${response.status}</a>`;
                    let buttonDel = `<a class="btn-confirm" id="btnDel" onclick="cancelFunc(otherid)">Delete</a>`;                    friBtn.html(buttonDel);
                    delBtn.html(buttonHTML);
                }
                else
                {
                    let buttonHTML = `<a class="btn-confirm" id="btn" onclick="${buttonAction}(otherid)">${response.status}</a>`;
                    friBtn.html(buttonHTML); // Use .html() to set the content of the element
                }


            }).fail(function(xhr, status, error) {
                alert('Request failed: ' + error);
            });

            function addFunc(userId){
                $.get('/friend/requestFriend', { sender: id, receiver:userId }, function(response) {
                    $('#btn').text("Cancel Request");
                    $('#btn').attr('onclick','cancelFunc('+userId+')');
                }).fail(function(xhr, status, error) {
                    alert('Request failed: ' + error);
                });
            }

            function cancelFunc(userId) {
                // Display a confirmation dialog to the user
                let prompt = confirm("Are you sure you want to delete this friend?");

                // Check the user's response
                if (prompt) {
                    // Proceed with the AJAX request if the user confirmed
                    $.ajax({
                        url: '/friend/deleteFriend', // your delete mapping URL
                        type: 'DELETE',
                        data: { sender: id, receiver: userId },
                        success: function(response) {
                            $('#btn').text("Add Friend");
                            $('#btn').attr('onclick', 'addFunc(' + userId + ')');

                            // Remove the "Delete" button from the UI
                            $('#btnDel').remove();
                        },
                        error: function(xhr, status, error) {
                            alert('Request failed: ' + error);
                        }
                    });
                } else {
                    // Optional: Handle the case where the user cancels the action
                    console.log("User canceled the delete action.");
                }
            }

            function  confirmFunc(userId)
            {
                $.ajax({
                    url: '/friend/acceptFriend', // your delete mapping URL
                    type: 'POST',
                    data: { sender: userId, receiver: id },
                    success: function(response) {
                        $('#btn').text("Friend");
                        $('#btn').attr('onclick', 'cancelFunc('+userId+')');

                        $('#btnDel').remove();
                    },
                    error: function(xhr, status, error) {
                        alert('Request failed: ' + error);
                    }
                });
            }

            $(document).ready(function(){
                $.ajax({
                    url: '/userInfo/'+otheremail+'', // Replace with your actual API endpoint
                    type: 'GET', // HTTP method
                    dataType: 'json', // The type of data you're expecting back from the server
                    success: function(data) {
                        $('#nm').text(data.name)
                        $('#em').text(data.email)
                        $('#addrs').text(data.address)
                        $('#gender').text(data.gender)
                        $('#mj').text(data.major)
                        $('#rno').text(data.rno)
                        $('#ph').text(data.phone)
                        $('#dob').text(data.dob)
                        $('#userBio').text(data.bio)
                        if(data.profile!=null) {
                            console.log(data.profile)

                            $('#my-profile-picture1').attr('src', 'files/' + data.profile + '');
                            $('#imageForModal').attr('src', 'files/'+data.profile + '');
                        }else{
                            $('#my-profile-picture1').attr('src', '/assests/noprofile.jpg');
                            $('#imageForModal').attr('src', '/assests/noprofile.jpg');
                        }


                    },
                    error: function(error) {
                        console.log("Error: ", error);
                    }
                });

            });
//get other wall
            console.log("mY ID"+id);
            console.log("OD"+otherid);
            $.get('/posts/getOtherWall', { mid: id, oid:otherid }, function(response) {


                if (Array.isArray(response)) {

                    var postsContainer = $('#postsContainer');
                    $('#my-profile-label').hide();
                    postsContainer.empty();// Clear any existing content
                    postsContainer.hide();

                    console.log(response);
                    response.forEach(function(data) {
                        var smodel=`<!--sharemodal-start-->
<div id="shareModal${data.id}" class="modalshare">
    <div class="modal-content">
        <span id="span-${data.id}" class="closeshare">&times;</span>
        <h2>Share Post</h2>
        <textarea id="shareContent-${data.id}" placeholder="Add a comment..."></textarea>
        <select id="shareAudience-${data.id}">
            <option value="Public">Public</option>
            <option value="Friends">Friends</option>
            <option value="FOFriends">FOFriends</option>
            <option value="Only Me">Only Me</option>
        </select>
        <button onclick="sharePost(${data.id})">Share</button>
    </div></div>
<!--sharemodal-end-->`;
                        $('body').append(smodel);
                        var boo;
                        if (Array.isArray(data.likes) && data.likes.length > 0) {
                            boo = data.likes.some(function (like) {
                                if (like.usrId == id) {
                                    return true;
                                } else {
                                    return false;
                                }
                            });

                        } else {
                            boo = false;
                        }
                        console.log(boo);
                        var postDiv;
                        if(data.parentPost!=null){
                            // console.log("not null parent");
                            // if (Array.isArray(data.likes) && data.likes.length > 0) {
                            //     boo2 = data.likes.some(function (like) {
                            //         if (like.usrId == id) {
                            //             return true;
                            //         } else {
                            //             return false;
                            //         }
                            //     });
                            //
                            // } else {
                            //     boo2 = false;
                            // }
                            // SHAREeeeeeeeeeeeeeeeeee
                            console.log("it is share")
                            postDiv  = `<div class="feed">
    <input type="hidden" id="op-${data.id}" value="${data.parentPost.id}" >
     <div class="feed-top">
                            <div class="user">
                                <div class="profile-picture">
                                   ${data.userProfile ? ` <img src="files/${data.userProfile}" alt="">`: ` <img src="/assests/noprofile.jpg" alt="">`}
                                </div>

                                <div class="info">
                                    <h3>${data.userName}</h3>
                                    <div class="time text-gry">
                                        <small><span>${timeAgo(data.createdAt)}</span></small>
                                        <small><span><i class="${(function() {
                                if (data.audience === 'Public') {
                                    return `fas fa-globe-asia`;
                                } else if(data.audience==='Friends') {
                                    return `fas fa-user`;
                                }else if(data.audience==='FOFriends'){
                                    return `fas fa-user-friends`
                                }else{
                                    return 'fas fa-lock'
                                }
                            })()}"></i></span></small>
                                    </div>
                                </div>
                            </div>

                        </div>
                          <div class="text-container">
        <p class="text" id="text">${data.content}
        </p>
        <span class="see-more" id="seeMore">See More</span>
    </div>
 <div class="feed" style="border: 1px solid black;">
                        <!------------------- Feed Top------------ -->

                        <div class="feed-top">
                            <div class="user">
                                <div class="profile-picture">
                                  ${data.parentPost.userProfile ? ` <img src="files/${data.parentPost.userProfile}" alt="">`: ` <img src="/assests/noprofile.jpg" alt="">`}

                                </div>

                                <div class="info">
                                    <h3>${data.parentPost.userName}</h3>
                                    <div class="time text-gry">
                                        <small><span>${timeAgo(data.parentPost.createdAt)}</span></small>
                                        <small><span><i class="${(function() {
                                if (data.parentPost.audience === 'Public') {
                                    return `fas fa-globe-asia`;
                                } else if(data.parentPost.audience==='Friends') {
                                    return `fas fa-user`;
                                }else if(data.parentPost.audience==='FOFriends'){
                                    return `fas fa-user-friends`
                                }else{
                                    return 'fas fa-lock'
                                }
                            })()}"></i></span></small>
                                    </div>
                                </div>
                            </div>

                        </div>
                          <div class="text-container">
        <p class="text" id="text">${data.parentPost.content}
        </p>
        <span class="see-more" id="seeMore">See More</span>
    </div>

                        <!------------------- Feed Img------------ -->
                       ${data.parentPost.images.length > 1 ? `
                <div class="swiper mySwiper2">
                    <div class="swiper-wrapper">
                        ${data.parentPost.images.map(image => `
                            <div class="swiper-slide">
                                <div class="feed-img">

                                    <img src="files/images/${image.image_url}" alt="">
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <!-- Add Pagination -->
                    <div class="swiper-pagination"></div>
                    <!-- Add Navigation -->
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                    <!-- Add Scrollbar -->
                    <div class="swiper-scrollbar"></div>
                </div>
            ` : `
                <div class="feed-img">

                   ${data.parentPost.images[0] != null ? `<img src="files/images/${data.parentPost.images[0].image_url}" alt="">` : ''}
                </div>
            `}




</div>

    <div class="action-button">
                            <div class="interaction-button">
                                <span id="Like-${data.id}" onclick="${boo === true ? `deleteLike(${id},${data.id})` : `addLike(${id},${data.id})`}"><i id="LikeIcon-${data.id}" class="${boo === true ? `fa-brands fa-gratipay` : `fa fa-heart`}"></i></span>
                                <span id="likeCount${data.id}">${data.likes.length}</span><a data-link href="comments/${data.id}"><span><i class="fa fa-comment-dots"></i></span></a>
                                ${data.comments.length}&nbsp;&nbsp;&nbsp;<span onclick="shModal(${data.id})"><i class="fa fa-link"></i></span>
                            </div>

                        </div>
                    </div>`;
                        }else{
                            postDiv = `<div class="feed">
                        <!------------------- Feed Top------------ -->
                        <input type="hidden" id="op-${data.id}" value="${data.id}" >
                        <div class="feed-top">

                            <div class="user">
                                <div class="profile-picture">
                                    ${data.userProfile ? `<img src="files/${data.userProfile}" alt="">`: `<img src="/assests/noprofile.jpg" alt="">`}
                                </div>

                                <div class="info">
                                    <h3>${data.userName}</h3>
                                    <div class="time text-gry">
                                        <small><span>${timeAgo(data.createdAt)}</span></small>
                                        <small><span><i class="${(function() {
                                if (data.audience === 'Public') {
                                    return `fas fa-globe-asia`;
                                } else if(data.audience==='Friends') {
                                    return `fas fa-user`;
                                }else if(data.audience==='FOFriends'){
                                    return `fas fa-user-friends`
                                }else{
                                    return 'fas fa-lock'
                                }
                            })()}"></i></span></small>
                                    </div>
                                </div>
                            </div>

                        </div>
                      <div class="text-container">
        <p class="text" id="text">${data.content}
        </p>
        <span class="see-more" id="seeMore">See More</span>
    </div>

                        <!------------------- Feed Img------------ -->
                       ${data.images.length > 1 ? `
                <div class="swiper mySwiper2">
                    <div class="swiper-wrapper">
                        ${data.images.map(image => `
                            <div class="swiper-slide">
                                <div class="feed-img">

                                    <img src="files/images/${image.image_url}" alt="">
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <!-- Add Pagination -->
                    <div class="swiper-pagination"></div>
                    <!-- Add Navigation -->
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                    <!-- Add Scrollbar -->
                    <div class="swiper-scrollbar"></div>
                </div>
            ` : `
                <div class="feed-img">

                   ${data.images[0] != null ? `<img src="files/images/${data.images[0].image_url}" alt="">` : ''}
                </div>
            `}

                        <!------------------- Feed Action Aria------------ -->
                        <div class="action-button">
                            <div class="interaction-button">
                                <span id="Like-${data.id}" onclick="${boo===true ? `deleteLike(${id},${data.id})`:`addLike(${id},${data.id})`}"><i id="LikeIcon-${data.id}" class="${boo===true ? `fa-brands fa-gratipay`:`fa fa-heart`}"></i></span>
                                <span id="likeCount${data.id}">${data.likes.length}</span><a data-link href="comments/${data.id}"><span><i class="fa fa-comment-dots"></i></span></a>
                                ${data.comments.length}&nbsp;&nbsp;&nbsp;<span onclick="shModal(${data.id})"><i class="fa fa-link"></i></span>
                            </div>

                        </div>



                        <!-- -------------Comments------------ -->
                        <div class="comments text-gry">
                            View all comments
                        </div>

                    </div>`;
                        }

                        document.getElementById('postsContainer').insertAdjacentHTML('beforeend', postDiv);
                    });

                    var mySwiper2 = new Swiper('.mySwiper2', {
                        slidesPerView: 1,
                        spaceBetween: 10,
                        loop: true,

                        pagination: {
                            el: '.swiper-pagination',
                            clickable: true,
                        },
                        navigation: {
                            nextEl: '.swiper-button-next',
                            prevEl: '.swiper-button-prev',
                        },
                        scrollbar: {
                            el: '.swiper-scrollbar',
                            hide: true,
                        },
                    });

                    $(document).ready(function() {
                        setTimeout(function() {
                            $('body').removeAttr('style');
                            $('#loadingImage').hide();
                            $('#pfAdjust').show();
                            postsContainer.show();
                            console.log("success");
                        }, 1500); // 3000 milliseconds = 3 seconds
                    });
                    console.log("success");
                } else {
                    console.log('Response is not an array:', response);
                }

            }).fail(function(xhr, status, error) {
                alert('Request failed: ' );
            });



        }else {
            $(document).ready(function(){
// get my wall
                $.ajax({
                    url: '/userInfo/'+username+'', // Replace with your actual API endpoint
                    type: 'GET', // HTTP method
                    dataType: 'json', // The type of da
                    // ta you're expecting back from the server
                    success: function(data) {
                        $('#my-profile-label').removeClass('hidden');
                        $('#nm').text(data.name)
                        $('#em').text(data.email)
                        $('#addrs').text(data.address)
                        $('#gender').text(data.gender)
                        $('#mj').text(data.major)
                        $('#rno').text(data.rno)
                        $('#ph').text(data.phone)
                        $('#dob').text(data.dob)


                        // Access specific keys from the JSON object

                        //edit auto fill

                        $('#name').val(data.name)              // Assuming 'name' is an input field with id 'name'
                        $('#major').val(data.major)           // Assuming 'major' is an input field with id 'major'
                        $('#phone').val(data.phone)           // Assuming 'phone' is an input field with id 'phone'
                        $('#roll-number').val(data.rno)        // Assuming 'roll-number' is an input field with id 'roll-number'
                        $('#address').val(data.address)
                        $('#date-of-birth').val(data.dob)

                        $('#nameForModal').text(data.name)
                        $('#name2ForModal').text(data.email)
                        if(data.gender==="Male")
                        {
                            $('input[name="gender"][value="Male"]').prop('checked',true);
                        }
                        if(data.gender==="Female")
                        {
                            $('input[name="gender"][value="Female"]').prop('checked',true);
                        }

                        if(data.bio===null)
                        {
                            $('#userBio').text("Add Your Bio..")
                        }
                        else
                        {
                            $('#userBio').text(data.bio)
                        }

                        if(data.profile!=null) {
                            $('#my-profile-picture1').attr('src', 'files/' + data.profile + '');
                            $('#imageForModal').attr('src', 'files/'+data.profile + '');
                        }else{
                            $('#my-profile-picture1').attr('src', '/assests/noprofile.jpg');
                            $('#imageForModal').attr('src', '/assests/noprofile.jpg');
                        }
                        //auto fill


                    },
                    error: function(error) {
                        console.log("Error: ", error);
                    }
                });

                //get My Wall
                    $.get('/posts/getMyWall', { id: id }, function(response) {

                    if (Array.isArray(response)) {
                        $('#my-profile-label').hide();
                    var postsContainer = $('#postsContainer');
                    postsContainer.empty();// Clear any existing content
                    console.log(response);
                    postsContainer.hide();
                    response.forEach(function(data) {
                        var smodel=`<!--sharemodal-start-->
<div id="shareModal${data.id}" class="modalshare">
    <div class="modal-content">
        <span id="span-${data.id}" class="closeshare">&times;</span>
        <h2>Share Post</h2>
        <textarea id="shareContent-${data.id}" placeholder="Add a comment..."></textarea>
        <select id="shareAudience-${data.id}">
            <option value="Public">Public</option>
            <option value="Friends">Friends</option>
            <option value="FOFriends">FOFriends</option>
            <option value="Only Me">Only Me</option>
        </select>
        <button onclick="sharePost(${data.id})">Share</button>
    </div></div>
<!--sharemodal-end-->`;
                        $('body').append(smodel);
                        var boo;
                        if (Array.isArray(data.likes) && data.likes.length > 0) {
                            boo = data.likes.some(function (like) {
                                if (like.usrId == id) {
                                    return true;
                                } else {
                                    return false;
                                }
                            });

                        } else {
                            boo = false;
                        }
                    console.log(boo);
                        var postDiv;
                        if(data.parentPost!=null){
                            // console.log("not null parent");
                            // if (Array.isArray(data.likes) && data.likes.length > 0) {
                            //     boo2 = data.likes.some(function (like) {
                            //         if (like.usrId == id) {
                            //             return true;
                            //         } else {
                            //             return false;
                            //         }
                            //     });
                            //
                            // } else {
                            //     boo2 = false;
                            // }
                            // SHAREeeeeeeeeeeeeeeeeee
                            console.log("it is share")
                            postDiv  = `<div class="feed">
    <input type="hidden" id="op-${data.id}" value="${data.parentPost.id}" >


     <div class="feed-top">
                            <div class="user">
                                <div class="profile-picture">
                                    ${data.userProfile ? `<img src="files/${data.userProfile}" alt="">`: `<img src="/assests/noprofile.jpg" alt="">`}
                                </div>

                                <div class="info">
                                    <h3>${data.userName}</h3>
                                    <div class="time text-gry">
                                        <small><span>${timeAgo(data.createdAt)}</span></small>
                                        <small><span><i class="${(function() {
                                if (data.audience === 'Public') {
                                    return `fas fa-globe-asia`;
                                } else if(data.audience==='Friends') {
                                    return `fas fa-user`;
                                }else if(data.audience==='FOFriends'){
                                    return `fas fa-user-friends`
                                }else{
                                    return 'fas fa-lock'
                                }
                            })()}"></i></span></small>
                                    </div>
                                </div>
                            </div>

                        </div>
                          <div class="text-container">
        <p class="text" id="text">${data.content}</p>
        <span class="see-more" id="seeMore">See More</span>
    </div>
 <div class="feed" style="border: 1px solid black;">
                        <!------------------- Feed Top------------ -->

                        <div class="feed-top">
                            <div class="user">
                                <div class="profile-picture">
                                    ${data.parentPost.userProfile ? `<img src="files/${data.parentPost.userProfile}" alt="">`: `<img src="/assests/noprofile.jpg" alt="">`}
                                </div>

                                <div class="info">
                                    <h3>${data.parentPost.userName}</h3>
                                    <div class="time text-gry">
                                        <small><span>${timeAgo(data.parentPost.createdAt)}</span></small>
                                        <small><span><i class="${(function() {
                                if (data.parentPost.audience === 'Public') {
                                    return `fas fa-globe-asia`;
                                } else if(data.parentPost.audience==='Friends') {
                                    return `fas fa-user`;
                                }else if(data.parentPost.audience==='FOFriends'){
                                    return `fas fa-user-friends`
                                }else{
                                    return 'fas fa-lock'
                                }
                            })()}"></i></span></small>
                                    </div>
                                </div>
                            </div>

                        </div>
                          <div class="text-container">
        <p class="text" id="text">${data.parentPost.content}</p>
        <span class="see-more" id="seeMore">See More</span>
    </div>

                        <!------------------- Feed Img------------ -->
                       ${data.parentPost.images.length > 1 ? `
                <div class="swiper mySwiper2">
                    <div class="swiper-wrapper">
                        ${data.parentPost.images.map(image => `
                            <div class="swiper-slide">
                                <div class="feed-img">

                                    <img src="files/images/${image.image_url}" alt="">
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <!-- Add Pagination -->
                    <div class="swiper-pagination"></div>
                    <!-- Add Navigation -->
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                    <!-- Add Scrollbar -->
                    <div class="swiper-scrollbar"></div>
                </div>
            ` : `
                <div class="feed-img">

                   ${data.parentPost.images[0] != null ? `<img src="files/images/${data.parentPost.images[0].image_url}" alt="">` : ''}
                </div>
            `}




</div>

    <div class="action-button">
                            <div class="interaction-button">
                                <span id="Like-${data.id}" onclick="${boo === true ? `deleteLike(${id},${data.id})` : `addLike(${id},${data.id})`}"><i id="LikeIcon-${data.id}" class="${boo === true ? `fa-brands fa-gratipay` : `fa fa-heart`}"></i></span>
                                <span id="likeCount${data.id}">${data.likes.length}</span><a data-link href="comments/${data.id}"><span><i class="fa fa-comment-dots"></i></span></a>
                                ${data.comments.length}&nbsp;&nbsp;&nbsp;<span onclick="shModal(${data.id})"><i class="fa fa-link"></i></span>
                            </div>

                        </div>
                    </div>`;
                        }else{
                            postDiv = `<div class="feed">
    <input type="hidden" id="op-${data.id}" value="${data.id}" >

                        <!------------------- Feed Top------------ -->

                        <div class="feed-top">
                            <div class="user">
                                <div class="profile-picture">
                                    ${data.userProfile ? `<img src="files/${data.userProfile}" alt="">`: `<img src="/assests/noprofile.jpg" alt="">`}
                                </div>

                                <div class="info">
                                    <h3>${data.userName}</h3>
                                    <div class="time text-gry">
                                        <small><span>${timeAgo(data.createdAt)}</span></small>
                                        <small><span><i class="${(function() {
                                if (data.audience === 'Public') {
                                    return `fas fa-globe-asia`;
                                } else if(data.audience==='Friends') {
                                    return `fas fa-user`;
                                }else if(data.audience==='FOFriends'){
                                    return `fas fa-user-friends`
                                }else{
                                    return 'fas fa-lock'
                                }
                            })()}"></i></span></small>
                                    </div>
                                </div>
                            </div>

                        </div>
                      <div class="text-container">
        <p class="text" id="text">${data.content}</p>
        <span class="see-more" id="seeMore">See More</span>
    </div>

                        <!------------------- Feed Img------------ -->
                       ${data.images.length > 1 ? `
                <div class="swiper mySwiper2">
                    <div class="swiper-wrapper">
                        ${data.images.map(image => `
                            <div class="swiper-slide">
                                <div class="feed-img">

                                    <img src="files/images/${image.image_url}" alt="">
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <!-- Add Pagination -->
                    <div class="swiper-pagination"></div>
                    <!-- Add Navigation -->
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                    <!-- Add Scrollbar -->
                    <div class="swiper-scrollbar"></div>
                </div>
            ` : `
                <div class="feed-img">

                   ${data.images[0] != null ? `<img src="files/images/${data.images[0].image_url}" alt="">` : ''}
                </div>
            `}

                        <!------------------- Feed Action Aria------------ -->
                        <div class="action-button">
                            <div class="interaction-button">
                                <span id="Like-${data.id}" onclick="${boo===true ? `deleteLike(${id},${data.id})`:`addLike(${id},${data.id})`}"><i id="LikeIcon-${data.id}" class="${boo===true ? `fa-brands fa-gratipay`:`fa fa-heart`}"></i></span>
                                <span id="likeCount${data.id}">${data.likes.length}</span><a data-link href="comments/${data.id}"><span><i class="fa fa-comment-dots"></i></span></a>
                                ${data.comments.length}&nbsp;&nbsp;&nbsp;<span onclick="shModal(${data.id})"><i class="fa fa-link"></i></span>
                            </div>

                        </div>



                        <!-- -------------Comments------------ -->
                        <div class="comments text-gry">
                            View all comments
                        </div>

                    </div>`;
                        }

                    document.getElementById('postsContainer').insertAdjacentHTML('beforeend', postDiv);
                });
                    var mySwiper2 = new Swiper('.mySwiper2', {
                    slidesPerView: 1,
                    spaceBetween: 10,
                    loop: true,

                    pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
                    navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                    scrollbar: {
                    el: '.swiper-scrollbar',
                    hide: true,
                },
                });
                    console.log("success");

                        $(document).ready(function() {
                            setTimeout(function() {
                                $('body').removeAttr('style');
                                $('#pfAdjust').show();
                                $('#my-profile-label').show();
                                postsContainer.show();
                                console.log("success");
                            }, 1500); // 3000 milliseconds = 3 seconds
                        });
                } else {
                    console.log('Response is not an array:', response);
                }
                }).fail(function(xhr, status, error) {
                    alert('Request failed: ' + error);
                });


            });
        }


        //edit profile

        $(document).ready(function() {
            $('#editProfile').click(function() {
                console.log("btn clicked")
                var editUser = {
                    "name": $('#name').val(),              // Assuming 'name' is an input field with id 'name'
                    "major": $('#major').val(),            // Assuming 'major' is an input field with id 'major'
                    "phone": $('#phone').val(),            // Assuming 'phone' is an input field with id 'phone'
                    "rno": $('#roll-number').val(),        // Assuming 'roll-number' is an input field with id 'roll-number'
                    "address": $('#address').val(),
                    "gender":$('input[name="gender"]:checked').val(),
                    "dob":$('#date-of-birth').val()

                };
                console.log(editUser)

                $.ajax({
                    url: '/editProfile/'+username+'',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(editUser),
                    success: function(response) {
                        alert('Update successful: ' + response);
                        $('#nm').text(editUser.name)
                        $('#em').text(editUser.email)
                        $('#addrs').text(editUser.address)
                        $('#gender').text(editUser.gender)
                        $('#mj').text(editUser.major)
                        $('#rno').text(editUser.rno)
                        $('#ph').text(editUser.phone)
                        $('#dob').text(editUser.dob)
                    },
                    error: function(error) {
                        alert('Update failed: ' + error.responseText);
                    }
                });
            });
        });

        //edit profile
        function uploadImage() {
            var fileInput = document.getElementById('profile-upload');

            if (fileInput.files.length === 0) {
                alert("Please select a file.");
                return;
            }

            var formData = new FormData();
            var file = fileInput.files[0];
            formData.append('image', file);
            formData.append('email', username)// Append file with its name

            $.ajax({
                url: '/uploadImage', // Replace with your actual API endpoint
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    console.log('Image uploaded successfully:', response);
                    alert('Image uploaded successfully');
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    console.error('Error uploading image:', textStatus, errorThrown);
                    alert('Error uploading image');
                }
            });
        }

        function labelFun(){
            console.log("safsdsddfsad lar san");
            document.querySelector('.profile-popup').style.display = 'flex';
        }
    </script>
<!--search-->
    <script>
        document.getElementById('search').addEventListener('keydown', function (event) {
            if (event.key === 'Enter') {
                event.preventDefault(); // Prevent the default action (form submission)
                // Perform your action here
                const searchValue = event.target.value;
                console.log('Search value:', searchValue);
                // You can call a function or redirect to a search results page, for example
                window.location.href = `/search?query=${searchValue}`;
            }
        });
    </script>
    <!--search-->
    <script src="./Assets/Script.js"></script>





</body>

</html>