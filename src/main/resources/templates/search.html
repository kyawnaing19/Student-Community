<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Community </title>
    <!-- ------------------Custom Css link -->
    <link rel="stylesheet" href="./Assets/search.css">
    <!-- ----Font Awesome  -->
    <link rel="stylesheet" href="./fontawesome-free-6.3.0-web/all.min.css">


    <!-- -------Swiper Slider Link------ -->

    <link rel="stylesheet" href="./Assets/Swiper/swiper-bundle.min.css">

</head>

<body>


    <!-- ..................Start Navbar...................... -->
    <nav>
        <div class="container nav-container">
            <div class="logo">
                <img src="/assests/Untitled-1.png" style="width: 100%; height: 50px;">
            </div>
            <div class="serch-bar">
                <i class="fa fa-search"></i>
                <input type="search" name="" id="search" placeholder="Search For Creators">
            </div>
            <div class="add-post">
                <div class="" style="width:100%;position: absolute;">


                    <a onclick="let userConfirmed = confirm('Are you sure you want to log out?'); if (userConfirmed) { window.location.href = 'logout'; }"><img title="Logout" src="/assests/OOjs_UI_icon_logOut-ltr-progressive.svg.png" alt="Logout" style="cursor:pointer;width: 30px;height:30px;"></a>
                </div>
            </div>
        </div>
    </nav>
    <!-- ...................Start Navbar................... -->


    <!-- ...................Start Main Session...................-->
    <main>
        <div class="container main-container">

            <!-- ...........Main Left Start......... -->


                <!--.....................  ALl friends.............. -->
            

  
                <!--.....................All friends End.............. -->

                <!-- ............Start Aside Bar for your all friends............... -->
                <aside>   
                        


                    
                </aside>

                <!-- ............End Aside Bar............... -->


            <!-- ...........Main Left End......... -->



            <!--======================Main Middle Start====================== -->
            <div class="main-middle">
                <div class="speople" id="users-container">



                </div>
            </div>
        
    </main>
    <!-- ...................End Main Session................... -->




    <!-- -----------------------Start PopUps Aria----------------- -->
    <!-- ----------Start Profile-Popup------------- -->
    <div class="popup profile-popup">
        <div>
            <div class="popup-box profile-popup-box">
                <h1>Aung Khaing Moe</h1>
                <p>@aungkhaingmoe</p>
                <div id="my-profile-picture">
                    <img src="./Assets/images/img/profile-1.jpeg">
                </div>
                <label for="profile-upload" class="btn btn-primary btn-lg"><a href="profile.html" style="text-decoration: none; color: aliceblue; font-weight: bolder;">View Profile Details</a></label>
                <!-- <input type="file" name="" accept="image/jpg , image/png, image/jpep" id="profile-upload"> -->
                <button class="btn btn-primary btn-lg">Log Out</button>
            </div>
            <span class="close"><i class="fa fa-close"></i></span>
        </div>
    </div>
    <!-- ----------End Profile-Popup------------- -->

    <!-- -----------------------End PopUps Aria----------------- -->


    <!-- ----------------Swiper JS---------------------- -->

    <script src="./Assets/Swiper/swiper-bundle.min.js"></script>
    <!-- Custom Js Link -->
    <script src="./Assets/Script.js"></script>
    <script src="assests/js/jquery.min.js"></script>


    <script>
       var query = '[[${query}]]';
       console.log(query);
       $('#search').val(query);
        document.getElementById('search').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault(); // Prevent the default action (form submission)
                // Perform your action here
                const searchValue = event.target.value;
                console.log('Search value:', searchValue);
                // You can call a function or redirect to a search results page, for example
                window.location.href = `/search?query=${searchValue}`;
            }
        });
    </script>
<script>
        var inputValue = '[[${query}]]';
        var email=sessionStorage.getItem("email");
        var id=sessionStorage.getItem("id");
        console.log(inputValue)
        $.get('/friend/getFriendDTO', { id: id, input:inputValue }, function(response) {
            if (Array.isArray(response)) {
                var usersContainer = $('#users-container');
                usersContainer.empty(); // Clear any existing content

                response.forEach(function(freindDTO) {
                    var buttonAction;
                    if(freindDTO.status==="Cancel Request")
                        buttonAction="cancelFunc";
                    if(freindDTO.status==="Add Friend")
                        buttonAction="addFunc";
                    if(freindDTO.status==="Confirm")
                        buttonAction="confirmFunc";
                    if(freindDTO.status==="Friend")
                        buttonAction="cancelFunc";

                    var userDiv = `
            <div class="user" id="user-${freindDTO.user.id}" >
                ${freindDTO.user.profile ? `<img class="user-img" src="/files/${freindDTO.user.profile}" alt="User Image">` : `<img class="user-img" src="/assests/noprofile.jpg" alt="User Image">`}
                <div class="content" style="width: 300px;" onclick="window.location.href='profile?otheremail=${freindDTO.user.email}&otherid=${freindDTO.user.id}'">
                    <h4>${freindDTO.user.name}</h4>
                    <div class="liked-by">

                    </div>
                </div>
                <div class="add-friend" style="">
                    <a class="btn-confirm" id="btn-${freindDTO.user.id}" onclick="${buttonAction}(${freindDTO.user.id})">${freindDTO.status}</a>
                </div>
            </div>
        `;

                    usersContainer.append(userDiv);
                });
                console.log("success");
            } else {
                console.log('Response is not an array:', response);
            }
        }).fail(function(xhr, status, error) {
            alert('Request failed: ' + error);
        });

        function addFunc(userId){
            $.get('/friend/requestFriend', { sender: id, receiver:userId }, function(response) {
                $('#btn-'+userId+'').text("Cancel Request");
                $('#btn-'+userId+'').attr('onclick','cancelFunc('+userId+')');
            }).fail(function(xhr, status, error) {
                alert('Request failed: ' + error);
            });
        }

        function cancelFunc(userId) {
            $.ajax({
                url: '/friend/deleteFriend', // your delete mapping URL
                type: 'DELETE',
                data: { sender: id, receiver: userId },
                success: function(response) {
                    $('#btn-'+userId+'').text("Add Friend");
                    $('#btn-'+userId+'').attr('onclick', 'addFunc('+userId+')');
                },
                error: function(xhr, status, error) {
                    alert('Request failed: ' + error);
                }
            });
        }

        function  confirmFunc(userId)
        {
            $.ajax({
                url: '/friend/acceptFriend', // your delete mapping URL
                type: 'POST',
                data: { sender: userId, receiver: id },
                success: function(response) {
                    $('#btn-'+userId+'').text("Friend");
                    $('#btn-'+userId+'').attr('onclick', 'cancelFunc('+userId+')');
                },
                error: function(xhr, status, error) {
                    alert('Request failed: ' + error);
                }
            });
        }

</script>

</body>

</html>