<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Community </title>
    <!-- ------------------Custom Css link -->
    <link rel="stylesheet" href="./Assets/search.css">
    <!-- ----Font Awesome  -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- -------Swiper Slider Link------ -->

    <link rel="stylesheet" href="./Assets/Swiper/swiper-bundle.min.css">

</head>

<body>


    <!-- ..................Start Navbar...................... -->
    <nav>
        <div class="container nav-container">
            <div class="logo">
                <h3>Community <span>Forum</span></h3>
            </div>
            <div class="serch-bar">
                <i class="fa fa-search"></i>
                <input type="search" name="" id="search" placeholder="Search For Creators">
            </div>
            <div class="add-post">
                <label for="add-post" class="btn btn-primary">Add Post</label>
                <div class="profile-picture" id="my-profile-picture">
                    <img src="./Assets/images/img/profile-1.jpeg" alt="">
                </div>
            </div>
        </div>
    </nav>
    <!-- ...................Start Navbar................... -->


    <!-- ...................Start Main Session...................-->
    <main>
        <div class="container main-container">

            <!-- ...........Main Left Start......... -->
            <div class="main-left">

                <!--.....................  ALl friends.............. -->
            
                    <div class="friends-suggest">
                        <div class="back">
                            <a href="friends.html" class="back-to">
                                <i class="fa-solid fa-arrow-left"></i>
                            </a>
                        </div>
                        <div class="text">
                            <h2>Search Result</h2>
                        </div>      
                    </div>
  
                <!--.....................All friends End.............. -->

                <!-- ............Start Aside Bar for your all friends............... -->
                <aside>   
                        
                        <div class="horizontal-line"></div>
                        <div class="cal-allfriend">
                            <p>Filter</p>
                        </div>
                    
                  

                    <a class="menu-item" href="">
                        <span>
                            <img src="./Assets/images/svg/friends-svgrepo-com.svg" alt="">
                        </span>
                        <h3>All</h3>
                    </a>

                    <a class="menu-item" href="">
                        <span>
                            <img src="./Assets/images/svg/friends-svgrepo-com.svg" alt="">
                        </span>
                        <h3>People</h3>
                    </a>

                    <a class="menu-item" href="">
                        <span>
                            <img src="./Assets/images/svg/friends-svgrepo-com.svg" alt="">
                        </span>
                        <h3>Post</h3>
                    </a>


                    <a class="menu-item" href="">
                        <span>
                            <img src="./Assets/images/svg/friends-svgrepo-com.svg" alt="">
                        </span>
                        <h3>Videos</h3>
                    </a>

                    <a class="menu-item" href="">
                        <span>
                            <img src="./Assets/images/svg/friends-svgrepo-com.svg" alt="">
                        </span>
                        <h3>Photo</h3>
                    </a>

                    <a class="menu-item" href="">
                        <span>
                            <img src="./Assets/images/svg/friends-svgrepo-com.svg" alt="">
                        </span>
                        <h3>Event</h3>
                    </a>

                    <a class="menu-item" href="">
                        <span>
                            <img src="./Assets/images/svg/friends-svgrepo-com.svg" alt="">
                        </span>
                        <h3>Group</h3>
                    </a>
                    

                    
                </aside>

                <!-- ............End Aside Bar............... -->

            </div>
            <!-- ...........Main Left End......... -->



            <!--======================Main Middle Start====================== -->
            <div class="main-middle">
                <div class="speople" id="users-container">



                </div>
            </div>
        
    </main>
    <!-- ...................End Main Session................... -->




    <!-- -----------------------Start PopUps Aria----------------- -->
    <!-- ----------Start Profile-Popup------------- -->
    <div class="popup profile-popup">
        <div>
            <div class="popup-box profile-popup-box">
                <h1>Aung Khaing Moe</h1>
                <p>@aungkhaingmoe</p>
                <div id="my-profile-picture">
                    <img src="./Assets/images/img/profile-1.jpeg">
                </div>
                <label for="profile-upload" class="btn btn-primary btn-lg"><a href="profile.html" style="text-decoration: none; color: aliceblue; font-weight: bolder;">View Profile Details</a></label>
                <!-- <input type="file" name="" accept="image/jpg , image/png, image/jpep" id="profile-upload"> -->
                <button class="btn btn-primary btn-lg">Log Out</button>
            </div>
            <span class="close"><i class="fa fa-close"></i></span>
        </div>
    </div>
    <!-- ----------End Profile-Popup------------- -->

    <!-- -----------------------End PopUps Aria----------------- -->


    <!-- ----------------Swiper JS---------------------- -->
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

    <script src="./Assets/Swiper/swiper-bundle.min.js"></script>
    <!-- Custom Js Link -->
    <script src="./Assets/Script.js"></script>
    <script src="assests/js/jquery.min.js"></script>


    <script>
       var query = '[[${query}]]';
       $('#search').val(query);
        document.getElementById('search').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault(); // Prevent the default action (form submission)
                // Perform your action here
                const searchValue = event.target.value;
                console.log('Search value:', searchValue);
                // You can call a function or redirect to a search results page, for example
                window.location.href = `/search?query=${searchValue}`;
            }
        });
    </script>
<script>
        var inputValue = '[[${query}]]';
        var email=sessionStorage.getItem("email");
        var id=sessionStorage.getItem("id");
        console.log(inputValue)
        $.get('/friend/getFriendDTO', { id: id, input:inputValue }, function(response) {
            if (Array.isArray(response)) {
                var usersContainer = $('#users-container');
                usersContainer.empty(); // Clear any existing content

                response.forEach(function(freindDTO) {
                    var buttonAction;
                    if(freindDTO.status==="Cancel Request")
                        buttonAction="cancelFunc";
                    if(freindDTO.status==="Add Friend")
                        buttonAction="addFunc";
                    if(freindDTO.status==="Confirm")
                        buttonAction="confirmFunc";
                    if(freindDTO.status==="Friend")
                        buttonAction="cancelFunc";

                    var userDiv = `
            <div class="user" id="user-${freindDTO.user.id}">
                <img class="user-img" src="/files/${freindDTO.user.profile}" alt="User Image">
                <div class="content">
                    <h4>${freindDTO.user.name}</h4>
                    <div class="liked-by">
                        <p><b>55</b> mutual friends</p>
                    </div>
                </div>
                <div class="add-friend">
                    <a class="btn-confirm" id="btn-${freindDTO.user.id}" onclick="${buttonAction}(${freindDTO.user.id})">${freindDTO.status}</a>
                </div>
            </div>
        `;

                    usersContainer.append(userDiv);
                });
                console.log("success");
            } else {
                console.log('Response is not an array:', response);
            }
        }).fail(function(xhr, status, error) {
            alert('Request failed: ' + error);
        });

        function addFunc(userId){
            $.get('/friend/requestFriend', { sender: id, receiver:userId }, function(response) {
                $('#btn-'+userId+'').text("Cancel Request");
                $('#btn-'+userId+'').attr('onclick','cancelFunc('+userId+')');
            }).fail(function(xhr, status, error) {
                alert('Request failed: ' + error);
            });
        }

        function cancelFunc(userId) {
            $.ajax({
                url: '/friend/deleteFriend', // your delete mapping URL
                type: 'DELETE',
                data: { sender: id, receiver: userId },
                success: function(response) {
                    $('#btn-'+userId+'').text("Add Friend");
                    $('#btn-'+userId+'').attr('onclick', 'addFunc('+userId+')');
                },
                error: function(xhr, status, error) {
                    alert('Request failed: ' + error);
                }
            });
        }

        function  confirmFunc(userId)
        {
            $.ajax({
                url: '/friend/acceptFriend', // your delete mapping URL
                type: 'POST',
                data: { sender: userId, receiver: id },
                success: function(response) {
                    $('#btn-'+userId+'').text("Friend");
                    $('#btn-'+userId+'').attr('onclick', 'cancelFunc('+userId+')');
                },
                error: function(xhr, status, error) {
                    alert('Request failed: ' + error);
                }
            });
        }

</script>

</body>

</html>